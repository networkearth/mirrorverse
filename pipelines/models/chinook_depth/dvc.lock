schema: '2.0'
stages:
  load_depth_data:
    cmd: mirrorverse_chinook_depth --function load_depth_data --output_file depth_data.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    outs:
    - path: depth_data.csv.gz
      hash: md5
      md5: 3f1a9b5ef00b9fca83315749ff81f78e
      size: 3838790
  add_depth_classes:
    cmd: mirrorverse_chinook_depth --function add_depth_classes --input_file depth_data.csv.gz
      --output_file depth_classes.csv.gz --depth_classes "[25, 50, 75, 100, 150, 200,
      250, 300, 400, 500]"
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    - path: depth_data.csv.gz
      hash: md5
      md5: 3f1a9b5ef00b9fca83315749ff81f78e
      size: 3838790
    params:
      params.yaml:
        depth_classes: '[25, 50, 75, 100, 150, 200, 250, 300, 400, 500]'
    outs:
    - path: depth_classes.csv.gz
      hash: md5
      md5: 09c32352738078c513795c249a01b3c9
      size: 4090990
  load_context_data:
    cmd: mirrorverse_chinook_depth --function load_context_data --output_file context_data.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    outs:
    - path: context_data.csv.gz
      hash: md5
      md5: 99f449fe85c8ec4d2a1afb9ca73ac36f
      size: 90645
  join_in_context_data:
    cmd: mirrorverse_chinook_depth --function join_in_context_data --input_files "depth_classes.csv.gz,context_data.csv.gz"
      --output_file warehouse_data.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    - path: context_data.csv.gz
      hash: md5
      md5: 99f449fe85c8ec4d2a1afb9ca73ac36f
      size: 90645
    - path: depth_classes.csv.gz
      hash: md5
      md5: 09c32352738078c513795c249a01b3c9
      size: 4090990
    outs:
    - path: warehouse_data.csv.gz
      hash: md5
      md5: 419430226b8902753adef1556253feff
      size: 4352241
  add_time_features:
    cmd: mirrorverse_chinook_depth --function add_time_features --input_file warehouse_data.csv.gz
      --output_file data_w_time_features.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/time.py
      hash: md5
      md5: 5a450ab92d7616cba382e3848c9c7dcc
      size: 1869
    - path: warehouse_data.csv.gz
      hash: md5
      md5: 419430226b8902753adef1556253feff
      size: 4352241
    outs:
    - path: data_w_time_features.csv.gz
      hash: md5
      md5: f5813b0ac97a526d82f9bc86681aa079
      size: 8252199
  fill_out_choices:
    cmd: mirrorverse_chinook_depth --function fill_out_choices --input_file downsampled.csv
      --output_file choices.csv.gz --depth_classes "[25, 50, 75, 100, 150, 200, 250,
      300, 400, 500]"
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/choices.py
      hash: md5
      md5: 1581cf34dd9800b088bc761752fe5775
      size: 1997
    - path: downsampled.csv
      hash: md5
      md5: f7b733788a7e68bcceb873d5fb3273d3
      size: 28927503
    params:
      params.yaml:
        depth_classes: '[25, 50, 75, 100, 150, 200, 250, 300, 400, 500]'
    outs:
    - path: choices.csv.gz
      hash: md5
      md5: 8494f7b9f8dbdd47823369b9a91e6fe1
      size: 13270050
  split_data:
    cmd: mirrorverse_chinook_depth --function split_data --input_file choices.csv.gz
      --output_file "full.csv.gz" --train_fraction 0.6
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 621153bca1dd6c7819942a57af8680f1
      size: 4303
    - path: choices.csv.gz
      hash: md5
      md5: 8494f7b9f8dbdd47823369b9a91e6fe1
      size: 13270050
    params:
      params.yaml:
        train_fraction: 0.6
    outs:
    - path: test_full.csv.gz
      hash: md5
      md5: 51e918492fe468fdee8f2462ed8e103a
      size: 5365881
    - path: train_full.csv.gz
      hash: md5
      md5: 8e67e1ea1527ecf7f08b6d2b85e1385f
      size: 7905215
  train_model:
    cmd: mirrorverse_chinook_depth --function train_model --input_files "train_full.csv.gz,test_full.csv.gz,param_sets.json,search_diagnostics.csv"
      --output_files "diagnostics.csv,model.pkl,test_preds.csv" --features "['depth_class',
      'month', 'elevation', 'sunrise', 'sunset', 'hour']" --iterations 5
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 48fbe425d48789c862e4773b9d03553b
      size: 4285
    - path: param_sets.json
      hash: md5
      md5: 1b951616a662c654d27e0b5a0c9902c5
      size: 1872
    - path: search_diagnostics.csv
      hash: md5
      md5: 03e12d565fc4402ec6f828f6c21eaf22
      size: 4352
    - path: test_full.csv.gz
      hash: md5
      md5: a5ddfd954ab2e3a389b453215818f634
      size: 5353349
    - path: train_full.csv.gz
      hash: md5
      md5: facd8486bbbfb781b3418e6687c1bb19
      size: 7917590
    params:
      params.yaml:
        features: "['depth_class', 'month', 'elevation', 'sunrise', 'sunset', 'hour']"
        iterations: 5
    outs:
    - path: diagnostics.csv
      hash: md5
      md5: 021701e8b46c1fac95fc8caa57fd15b9
      size: 289
    - path: model.pkl
      hash: md5
      md5: 1dfb07fba06989b4fafa6f87d028f955
      size: 1822352
    - path: test_preds.csv
      hash: md5
      md5: 02622e94656a300b7b1952e088e57f0b
      size: 77294096
  downsample_data:
    cmd: mirrorverse_chinook_depth --function downsample_data --input_file data_w_time_features.csv.gz
      --output_file downsampled.csv --size_per_individual 2000
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/choices.py
      hash: md5
      md5: 1581cf34dd9800b088bc761752fe5775
      size: 1997
    - path: data_w_time_features.csv.gz
      hash: md5
      md5: f5813b0ac97a526d82f9bc86681aa079
      size: 8252199
    params:
      params.yaml:
        size_per_individual: 2000
    outs:
    - path: downsampled.csv
      hash: md5
      md5: f7b733788a7e68bcceb873d5fb3273d3
      size: 28927503
  do_search:
    cmd: mirrorverse_chinook_depth --function do_search --input_files "train_full.csv.gz,test_full.csv.gz,params.json"
      --output_files "search_diagnostics.csv,param_sets.json" --features "['depth_class',
      'month', 'elevation', 'sunrise', 'sunset', 'hour']" --iterations 20 --num_param_sets
      1
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 48fbe425d48789c862e4773b9d03553b
      size: 4285
    - path: params.json
      hash: md5
      md5: cff1e8bf01694a6d1c559e5128694982
      size: 166
    - path: test_full.csv.gz
      hash: md5
      md5: a5ddfd954ab2e3a389b453215818f634
      size: 5353349
    - path: train_full.csv.gz
      hash: md5
      md5: facd8486bbbfb781b3418e6687c1bb19
      size: 7917590
    params:
      params.yaml:
        features: "['depth_class', 'month', 'elevation', 'sunrise', 'sunset', 'hour']"
        iterations: 20
        num_param_sets: 1
    outs:
    - path: param_sets.json
      hash: md5
      md5: bd85091cb9f400bd6278b818addef082
      size: 190
    - path: search_diagnostics.csv
      hash: md5
      md5: a63a7db95521bd3d54b903b14406b2da
      size: 1626
  merge_back:
    cmd: mirrorverse_chinook_depth --function merge_back --input_files "test_preds.csv,test_full.csv.gz"
      --output_file test_preds_w_choices.csv
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 48fbe425d48789c862e4773b9d03553b
      size: 4285
    - path: test_full.csv.gz
      hash: md5
      md5: a5ddfd954ab2e3a389b453215818f634
      size: 5353349
    - path: test_preds.csv
      hash: md5
      md5: 02622e94656a300b7b1952e088e57f0b
      size: 77294096
    outs:
    - path: test_preds_w_choices.csv
      hash: md5
      md5: d7b92ed38c2c25ae5c419d923b6a4da8
      size: 163754390
  group_results:
    cmd: mirrorverse_group -n test_preds_w_choices.csv -g 7 -v 50
    deps:
    - path: ../../../mirrorverse/grouper.py
      hash: md5
      md5: 1ee9fad29795aa88645d58b68b15af5f
      size: 9158
    - path: test_preds_w_choices.csv
      hash: md5
      md5: d7b92ed38c2c25ae5c419d923b6a4da8
      size: 163754390
    params:
      params.yaml:
        groups: 7
        num_generations: 50
    outs:
    - path: test_preds_w_choices_groupings.csv
      hash: md5
      md5: e543449bb7011383ff9d39c7370d77f3
      size: 1417
    - path: test_preds_w_choices_statistics.csv
      hash: md5
      md5: bf3313f73296db413b2cbdf8b41ecbb5
      size: 4356
