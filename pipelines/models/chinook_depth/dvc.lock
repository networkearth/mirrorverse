schema: '2.0'
stages:
  load_depth_data:
    cmd: mirrorverse_chinook_depth --function load_depth_data --output_file depth_data.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    outs:
    - path: depth_data.csv.gz
      hash: md5
      md5: 3f1a9b5ef00b9fca83315749ff81f78e
      size: 3838790
  add_depth_classes:
    cmd: mirrorverse_chinook_depth --function add_depth_classes --input_file depth_data.csv.gz
      --output_file depth_classes.csv.gz --depth_classes "[25, 50, 75, 100, 150, 200,
      250, 300, 400, 500]"
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    - path: depth_data.csv.gz
      hash: md5
      md5: 3f1a9b5ef00b9fca83315749ff81f78e
      size: 3838790
    params:
      params.yaml:
        depth_classes: '[25, 50, 75, 100, 150, 200, 250, 300, 400, 500]'
    outs:
    - path: depth_classes.csv.gz
      hash: md5
      md5: 09c32352738078c513795c249a01b3c9
      size: 4090990
  load_context_data:
    cmd: mirrorverse_chinook_depth --function load_context_data --output_file context_data.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    outs:
    - path: context_data.csv.gz
      hash: md5
      md5: 99f449fe85c8ec4d2a1afb9ca73ac36f
      size: 90645
  join_in_context_data:
    cmd: mirrorverse_chinook_depth --function join_in_context_data --input_files "depth_classes.csv.gz,context_data.csv.gz"
      --output_file warehouse_data.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/warehouse.py
      hash: md5
      md5: 3262b057c076d10fd54c808de2bff6a1
      size: 3775
    - path: context_data.csv.gz
      hash: md5
      md5: 99f449fe85c8ec4d2a1afb9ca73ac36f
      size: 90645
    - path: depth_classes.csv.gz
      hash: md5
      md5: 09c32352738078c513795c249a01b3c9
      size: 4090990
    outs:
    - path: warehouse_data.csv.gz
      hash: md5
      md5: 419430226b8902753adef1556253feff
      size: 4352241
  add_time_features:
    cmd: mirrorverse_chinook_depth --function add_time_features --input_file warehouse_data.csv.gz
      --output_file data_w_time_features.csv.gz
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/time.py
      hash: md5
      md5: 5a450ab92d7616cba382e3848c9c7dcc
      size: 1869
    - path: warehouse_data.csv.gz
      hash: md5
      md5: 419430226b8902753adef1556253feff
      size: 4352241
    outs:
    - path: data_w_time_features.csv.gz
      hash: md5
      md5: f5813b0ac97a526d82f9bc86681aa079
      size: 8252199
  fill_out_choices:
    cmd: mirrorverse_chinook_depth --function fill_out_choices --input_file downsampled.csv
      --output_file choices.csv.gz --depth_classes "[25, 50, 75, 100, 150, 200, 250,
      300, 400, 500]"
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/choices.py
      hash: md5
      md5: 1581cf34dd9800b088bc761752fe5775
      size: 1997
    - path: downsampled.csv
      hash: md5
      md5: aa1090a186db2c56182c8c17863bfd7c
      size: 14465645
    params:
      params.yaml:
        depth_classes: '[25, 50, 75, 100, 150, 200, 250, 300, 400, 500]'
    outs:
    - path: choices.csv.gz
      hash: md5
      md5: 6b1b27eae5bf7de5290805f084026651
      size: 6634323
  split_data:
    cmd: mirrorverse_chinook_depth --function split_data --input_file choices.csv.gz
      --output_file "full.csv.gz" --train_fraction 0.6
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 48fbe425d48789c862e4773b9d03553b
      size: 4285
    - path: choices.csv.gz
      hash: md5
      md5: 6b1b27eae5bf7de5290805f084026651
      size: 6634323
    params:
      params.yaml:
        train_fraction: 0.6
    outs:
    - path: test_full.csv.gz
      hash: md5
      md5: 7ce6b8deedade38feca0fe8a170e7fcf
      size: 2672610
    - path: train_full.csv.gz
      hash: md5
      md5: 9ba56009f9d2bc1550517b4e58e1a275
      size: 3961989
  train_model:
    cmd: mirrorverse_chinook_depth --function train_model --input_files "train_full.csv.gz,test_full.csv.gz,param_sets.json,search_diagnostics.csv"
      --output_files "diagnostics.csv,model.pkl,test_preds.csv" --features "['depth_class',
      'sunrise', 'sunset']" --iterations 3
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 48fbe425d48789c862e4773b9d03553b
      size: 4285
    - path: param_sets.json
      hash: md5
      md5: 74685aea61b52428f18ea9f7b7fa4e83
      size: 382
    - path: search_diagnostics.csv
      hash: md5
      md5: ec5e511cb5e318ab3d5619fe1e435f9a
      size: 728
    - path: test_full.csv.gz
      hash: md5
      md5: 7ce6b8deedade38feca0fe8a170e7fcf
      size: 2672610
    - path: train_full.csv.gz
      hash: md5
      md5: 9ba56009f9d2bc1550517b4e58e1a275
      size: 3961989
    params:
      params.yaml:
        features: "['depth_class', 'sunrise', 'sunset']"
        iterations: 3
    outs:
    - path: diagnostics.csv
      hash: md5
      md5: 8c690b2e88a3c78aad0830e42f155166
      size: 210
    - path: model.pkl
      hash: md5
      md5: 3385aeb57ca77eb97b322f2332e2303b
      size: 1472411
    - path: test_preds.csv
      hash: md5
      md5: cda3206dce77ac121bd9436b0aae652d
      size: 27241931
  downsample_data:
    cmd: mirrorverse_chinook_depth --function downsample_data --input_file data_w_time_features.csv.gz
      --output_file downsampled.csv --size_per_individual 1000
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/choices.py
      hash: md5
      md5: 1581cf34dd9800b088bc761752fe5775
      size: 1997
    - path: data_w_time_features.csv.gz
      hash: md5
      md5: f5813b0ac97a526d82f9bc86681aa079
      size: 8252199
    params:
      params.yaml:
        size_per_individual: 1000
    outs:
    - path: downsampled.csv
      hash: md5
      md5: aa1090a186db2c56182c8c17863bfd7c
      size: 14465645
  do_search:
    cmd: mirrorverse_chinook_depth --function do_search --input_files "train_full.csv.gz,test_full.csv.gz,params.json"
      --output_files "search_diagnostics.csv,param_sets.json" --features "['depth_class',
      'sunrise', 'sunset']" --iterations 3 --num_param_sets 2
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 48fbe425d48789c862e4773b9d03553b
      size: 4285
    - path: params.json
      hash: md5
      md5: 95d6dde71eb92b14c6680b6414cb30c2
      size: 172
    - path: test_full.csv.gz
      hash: md5
      md5: 7ce6b8deedade38feca0fe8a170e7fcf
      size: 2672610
    - path: train_full.csv.gz
      hash: md5
      md5: 9ba56009f9d2bc1550517b4e58e1a275
      size: 3961989
    params:
      params.yaml:
        features: "['depth_class', 'sunrise', 'sunset']"
        iterations: 3
        num_param_sets: 2
    outs:
    - path: param_sets.json
      hash: md5
      md5: 74685aea61b52428f18ea9f7b7fa4e83
      size: 382
    - path: search_diagnostics.csv
      hash: md5
      md5: ec5e511cb5e318ab3d5619fe1e435f9a
      size: 728
  merge_back:
    cmd: mirrorverse_chinook_depth --function merge_back --input_files "test_preds.csv,test_full.csv.gz"
      --output_file test_preds_w_choices.csv
    deps:
    - path: ../../../mirrorverse/models/chinook_depth/model.py
      hash: md5
      md5: 48fbe425d48789c862e4773b9d03553b
      size: 4285
    - path: test_full.csv.gz
      hash: md5
      md5: 7ce6b8deedade38feca0fe8a170e7fcf
      size: 2672610
    - path: test_preds.csv
      hash: md5
      md5: cda3206dce77ac121bd9436b0aae652d
      size: 27241931
    outs:
    - path: test_preds_w_choices.csv
      hash: md5
      md5: 5a588a2486fa2ea08f8a7f0459931df3
      size: 80854065
  group_results:
    cmd: mirrorverse_group -n test_preds_w_choices.csv -g 7 -v 50
    deps:
    - path: ../../../mirrorverse/grouper.py
      hash: md5
      md5: 1ee9fad29795aa88645d58b68b15af5f
      size: 9158
    - path: test_preds_w_choices.csv
      hash: md5
      md5: 5a588a2486fa2ea08f8a7f0459931df3
      size: 80854065
    params:
      params.yaml:
        groups: 7
        num_generations: 50
    outs:
    - path: test_preds_w_choices_groupings.csv
      hash: md5
      md5: 378e7bfa9ac14e7457f5de538de010b6
      size: 1431
    - path: test_preds_w_choices_statistics.csv
      hash: md5
      md5: 46da28ea6ebdc07ff5279aa41c181f6f
      size: 4381
