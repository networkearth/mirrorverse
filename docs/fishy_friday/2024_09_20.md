# September 20, 2024

## Demo!

### Haven

```yaml
database: demo
account: '575101084097'
region: 'us-east-1'
```

```bash
haven init config.yaml
```

```python
import os
import haven.db as db
os.environ['HAVEN_DATABASE'] = 'demo'

import pandas as pd
data = pd.DataFrame([
    {'name': 'Alice', 'age': 25, 'city': 'New York'},
    {'name': 'Bob', 'age': 30, 'city': 'New York'},
    {'name': 'Charlie', 'age': 35, 'city': 'Boston'},
    {'name': 'David', 'age': 40, 'city': 'Boston'},
])

db.write_data(data, 'people', ['city'])

db.drop_table('people')
```

### WaterCycle

```
watercycle deploy job
```

### Mimic

#### Building a Dataset

```json
{
    "database": "haven",
    "table": "depth_model_features_mk3",
    "train_partitions": 40,
    "test_partitions": 20,
    "max_choices": 10,
    "features": ["depth_class", "daytime", "month", "period_progress", "elevation"],
    "missing_values_map": {
        "depth_class": -1000,
        "daytime": -1000,
        "month": -1000,
        "period_progress": -1000,
        "elevation": -1000
    },
    "space": "mimic-log-odds",
    "dataset": "depth-model-mk3"
}
```

```bash
mimic log-odds build-dataset dataset.json
```

#### Training a Model

```json
{
    "experiment_name": "depth-model-mk3-session1",
    "space": "mimic-log-odds",
    "dataset": "depth-model-mk3",
    "max_choices": 10,
    "features": ["depth_class", "daytime", "month", "period_progress", "elevation"],
    "database": "haven",
    "table": "depth_model_mk3_session1",
    "models": [
        {
            "batch_size": 5000,
            "epochs": 15,
            "layers": [
                "D64",
                "D32",
                "D16"
            ]
        },
        {
            "batch_size": 10000,
            "epochs": 15,
            "layers": [
                "D16",
                "D8",
                "D4"
            ]
        }
    ]
}
```

```python
from tensorflow.keras.layers import Dense

LAYERS = {
    "D4": lambda: Dense(4, activation='relu'),
    "D8": lambda: Dense(8, activation='relu'),
    "D16": lambda: Dense(16, activation='relu'),
    "D32": lambda: Dense(32, activation='relu'),
    "D64": lambda: Dense(64, activation='relu'),
}
```

```bash
mimic log-odds run-experiment experiment.json layers.py
```

#### Running the Model

```json
{
    "database": "haven",
    "table": "depth_model_hypercube_mk3",
    "train_partitions": 0,
    "test_partitions": 4,
    "max_choices": 10,
    "features": ["depth_class", "daytime", "month", "period_progress", "elevation"],
    "missing_values_map": {
        "depth_class": -1000,
        "daytime": -1000,
        "month": -1000,
        "period_progress": -1000,
        "elevation": -1000
    },
    "space": "mimic-log-odds",
    "experiment_name": "depth-model-mk3-session1",
    "run_id": "697dc29ac80163163d968ef8dfb892878c84a650772949282d6e9b70cc06b5df",
    "upload_table": "depth-model-mk3-hypercube-inference"
}
```

```bash
mimic log-odds run-batch-infer infer.json
```
